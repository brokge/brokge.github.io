<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="brokge"><title>Android 应用内存分析 · 吾與爾</title><meta name="description" content="Android &amp;#x5F00;&amp;#x53D1;&amp;#x573A;&amp;#x666F;&amp;#x4E2D;&amp;#xFF0C;&amp;#x5206;&amp;#x6790;&amp;#x5185;&amp;#x5B58;&amp;#x6CC4;&amp;#x6F0F;&amp;#x60C5;&amp;#x51B5;
#&amp;#x6240;&amp;#x9700;&amp;#x5DE5;&amp;#x5"><meta name="keywords" content="吾与尔"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style-red.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><link rel="stylesheet" href="/css/prism-ghcolors.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div id="stage" class="container"><div class="row"><div id="side-bar" class="col-sm-3 col-xs-12 side-container invisible"><div class="vertical-text site-title"><h3 tabindex="-1" class="site-title-small"><a href="/" class="a-title">I and i</a></h3><h1 tabindex="-1" class="site-title-large"><a href="/" class="a-title">吾與爾</a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div id="site-nav" class="site-title-links"><ul><li><a href="/">首頁</a></li><li><a href="/archives">歸檔</a></li><li><a href="/categories">分類</a></li><li><a href="/tags">標籤</a></li><li> <a href="https://brokge.github.io/scrapydoc/">爬虫</a></li><li> <a href="https://brokge.github.io/linux-command-line/html/">Linux命令行</a></li><li><a href="/about/index.html">关于</a></li><li class="soc"><a href="https://github.com/brokge" target="_blank" rel="noopener noreferrer"><i class="fa fa-github">&nbsp;</i></a><a href="https://brokge.github.io/atom.xml" target="_blank" rel="noopener noreferrer"><i class="fa fa-rss">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2019&nbsp;<a target="_blank" href="https://brokge.github.io" rel="noopener noreferrer">brokge</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer><script type="text/javascript" id="maid-script" src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js?v=undefined"></script><script>if (window.mermaid) {
  var options = JSON.parse(document.getElementById('maid-script').getAttribute('mermaidoptioins'));
  mermaid.initialize(options);
}
 </script></div></div></div><div id="main-container" class="col-sm-9 col-xs-12 main-container invisible"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a>Android 应用内存分析</a></p><p class="post-meta"><span class="date meta-item">發佈於&nbsp;2019-06-30</span><span class="meta-item"><i class="fa fa-folder"></i><span>&nbsp;</span><a href="/categories/Android/" title="Android" class="a-tag">Android</a><span>&nbsp;</span><a href="/categories/Android/性能优化/" title="性能优化" class="a-tag">性能优化</a><span>&nbsp;</span></span><span class="meta-item"><i class="fa fa-tag"></i><span>&nbsp;</span><a href="/tags/Android/" title="Android" class="a-tag">Android</a><span>&nbsp;</span><a href="/tags/性能优化/" title="性能优化" class="a-tag">性能优化</a><span>&nbsp;</span></span></p><p class="post-abstract"></p><p>Android &#x5F00;&#x53D1;&#x573A;&#x666F;&#x4E2D;&#xFF0C;&#x5206;&#x6790;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x60C5;&#x51B5;</p>
<h2><a href="#suo-xu-gong-ju" class="header-anchor">#</a><span id="suo-xu-gong-ju">&#x6240;&#x9700;&#x5DE5;&#x5177;</span></h2><h3><a href="#1-mta" class="header-anchor">#</a><span id="1-mta">1. MTA</span></h3><p>Eclipse Memory Analysis Tools (MAT) &#x662F;&#x4E00;&#x4E2A;&#x5206;&#x6790; Java&#x5806;&#x6570;&#x636E;&#x7684;&#x4E13;&#x4E1A;&#x5DE5;&#x5177;&#xFF0C;&#x7528;&#x5B83;&#x53EF;&#x4EE5;&#x5B9A;&#x4F4D;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x7684;&#x539F;&#x56E0;&#x3002;</p>
<p>&#x5DE5;&#x5177;&#x5730;&#x5740; : <a href="https://www.eclipse.org/mat/" target="_blank" rel="noopener">https://www.eclipse.org/mat/</a></p>
<h3><a href="#2-androidstudio" class="header-anchor">#</a><span id="2-androidstudio">2. AndroidStudio</span></h3><ul>
<li>monitor</li>
</ul>
<p>&#x5B58;&#x5728; sdk/toools/ &#x4E0B;&#x7684; monitor</p>
<p>Dalvik Debug Monitor Server (DDMS) &#x662F; ADT&#x63D2;&#x4EF6;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x5176;&#x4E2D;&#x6709;&#x4E24;&#x9879;&#x529F;&#x80FD;&#x53EF;&#x7528;&#x4E8E;&#x5185;&#x5B58;&#x68C0;&#x67E5; :</p>
<blockquote>
<ol>
<li>heap &#x67E5;&#x770B;&#x5806;&#x7684;&#x5206;&#x914D;&#x60C5;&#x51B5;</li>
<li>allocation tracker&#x8DDF;&#x8E2A;&#x5185;&#x5B58;&#x5206;&#x914D;&#x60C5;&#x51B5;</li>
</ol>
</blockquote>
<p>DDMS &#x8FD9;&#x4E24;&#x9879;&#x529F;&#x80FD;&#x6709;&#x52A9;&#x4E8E;&#x627E;&#x5230;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x7684;&#x64CD;&#x4F5C;&#x884C;&#x4E3A;&#x3002;</p>
<ul>
<li>profiler </li>
</ul>
<p>AndroidStudio &#x5185;&#x7F6E;&#x7684; &#x5185;&#x5B58;&#x68C0;&#x6D4B;&#x5DE5;&#x5177;&#xFF0C;&#x53EF;&#x4EE5;&#x56DE;&#x6536;&#x5185;&#x5B58;&#x548C;&#x4E0B;&#x8F7D;dump&#x3002;</p>
<h2><a href="#shi-yong" class="header-anchor">#</a><span id="shi-yong">&#x4F7F;&#x7528;</span></h2><ol>
<li>&#x901A;&#x8FC7; AndroidStudio &#x5185;&#x7F6E;&#x5DE5;&#x5177; profiler &#x8FDB;&#x884C;&#x5206;&#x6790;&#x5E76;&#x83B7;&#x53D6;&#x5230;.hprof &#x6587;&#x4EF6;&#x3002;</li>
</ol>
<blockquote>
<p>&#x64CD;&#x4F5C;&#x6B65;&#x9AA4;</p>
<ol>
<li>&#x6253;&#x5F00; profiler &#x7A97;&#x53E3;&#x3002;</li>
<li>&#x5207;&#x6362;&#x5230; memory .</li>
<li>&#x9488;&#x5BF9;&#x9700;&#x8981;&#x68C0;&#x6D4B;&#x7684;&#x9875;&#x9762;&#xFF0C;&#x70B9;&#x51FB; <code>&#x56DE;&#x6536;&#x7BB1;</code> &#x6309;&#x94AE;&#xFF0C;&#x8FDB;&#x884C;&#x5F3A;&#x5236; GC.&#x7136;&#x540E; &#x70B9;&#x51FB; <code>&#x4E0B;&#x8F7D;&#x56FE;&#x6807;</code> &#x6309;&#x94AE;  &#x83B7;&#x53D6;&#x5806;&#x6808;&#x4FE1;&#x606F;.</li>
<li>&#x6392;&#x5E8F;&#x65B9;&#x5F0F; Arrange by package &#xFF0C;&#x67E5;&#x770B;&#x5F85;&#x68C0;&#x6D4B;&#x7684;&#x6CC4;&#x6F0F;&#x5BF9;&#x8C61;&#x3002;</li>
<li>&#x5BFC;&#x51FA; .hprof &#x6587;&#x4EF6;&#x3002;</li>
</ol>
</blockquote>
<ol start="2">
<li>&#x901A;&#x8FC7; sdk &#x76EE;&#x5F55; platform-tools/hprof-conv &#x5DE5;&#x5177;&#x8FDB;&#x884C;&#x8F6C;&#x6362;</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">hrpof-conv -z <span class="token punctuation">[</span>&#x5F85;&#x8F6C;&#x6362;.hprof<span class="token punctuation">]</span>  <span class="token punctuation">[</span>&#x8F6C;&#x6362;&#x540E;.hprof<span class="token punctuation">]</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="3">
<li>&#x4EE5;&#x4E0A;&#x8F6C;&#x6362;&#x540E;&#x7684; .hprof&#x6587;&#x4EF6;&#xFF0C;&#x901A;&#x8FC7; mat &#x6253;&#x5F00;&#xFF0C;&#x7136;&#x540E;&#x70B9;&#x51FB;  histogram &#x3002;</li>
</ol>
<blockquote>
<p>&#x8FDB;&#x5165;Histogram<br>&#x53EF;&#x4EE5;&#x70B9;&#x51FB;&#x8868;&#x5934;&#x8FDB;&#x884C;&#x6392;&#x5E8F;,&#x5728;&#x8868;&#x7684;&#x7B2C;&#x4E00;&#x884C;&#x53EF;&#x4EE5;&#x8F93;&#x5165;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x6765;&#x5339;&#x914D;&#x7ED3;&#x679C;,&#x627E;&#x5230;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x627E;&#x7684;&#x7C7B;&#xFF0C;&#x7136;&#x540E;&#x53F3;&#x952E;&#x9009;&#x62E9;<code>merge shortest paths to Gc roots</code> &#x7136;&#x540E;&#x5728;&#x9009;&#x62E9;<code>exclude all phantom/weak/soft etc.references</code>&#x9009;&#x9879;.</p>
</blockquote>
<h2><a href="#fen-xi-xiao-ji-qiao" class="header-anchor">#</a><span id="fen-xi-xiao-ji-qiao">&#x5206;&#x6790;&#x5C0F;&#x6280;&#x5DE7;</span></h2><ol>
<li><code>Histogram</code> &#x5BF9;&#x6BD4;</li>
</ol>
<p>&#x4E3A;&#x67E5;&#x627E;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#xFF0C;&#x901A;&#x5E38;&#x9700;&#x8981;&#x4E24;&#x4E2A; Dump&#x7ED3;&#x679C;&#x4F5C;&#x5BF9;&#x6BD4;&#xFF0C;&#x6253;&#x5F00; <code>Navigator History</code>&#x9762;&#x677F;&#xFF0C;&#x5C06;&#x4E24;&#x4E2A;&#x8868;&#x7684; <code>Histogram</code>&#x7ED3;&#x679C;&#x90FD;&#x6DFB;&#x52A0;&#x5230; <code>Compare Basket</code>&#x4E2D;&#x53BB; :<br>&#x6DFB;&#x52A0;&#x597D;&#x540E;&#xFF0C;&#x6253;&#x5F00; Compare Basket&#x9762;&#x677F;&#xFF0C;&#x5F97;&#x5230;&#x7ED3;&#x679C;&#x3002;</p>
<ol start="2">
<li>&#x4F7F;&#x7528; <code>android:largeHeap=&quot;true&quot;</code>&#x6807;&#x8BB0; (API Level &gt;= 11) </li>
</ol>
<p>&#x5728; <code>AndroidManifest.xml</code>&#x4E2D;&#x7684; Application&#x8282;&#x70B9;&#x4E2D;&#x58F0;&#x660E;&#x5373;&#x53EF;&#x5206;&#x914D;&#x5230;&#x66F4;&#x5927;&#x7684;&#x5806;&#x5185;&#x5B58;, <code>android:largeHeap</code>&#x6807;&#x8BB0;&#x5728; Android&#x7CFB;&#x7EDF;&#x5E94;&#x7528;&#x4E2D;&#x4E5F;&#x6709;&#x5E7F;&#x6CDB;&#x7684;&#x5E94;&#x7528; ,&#x6BD4;&#x5982; Launcher, Browser&#x8FD9;&#x4E9B;&#x5185;&#x5B58;&#x5927;&#x6237;&#x4E0A;&#x5747;&#x6709;&#x4F7F;&#x7528;.</p>
<ol start="3">
<li>mat &#x6253;&#x5F00;&#x5DE5;&#x5177;&#x680F; <code>QQL</code>&#x56FE;&#x6807;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; &#x7C7B;sql &#x8BED;&#x53E5;&#x7B5B;&#x67E5;<pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">select</span> * from instanceof android.app.Activity
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li>mat &#x4E2D; Actions &#x4E2D;&#x7684;&#x6982;&#x5FF5;</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># Histogram</span>
&#x5217;&#x51FA;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5BF9;&#x8C61;&#x7684;&#x4E2A;&#x6570;&#x4EE5;&#x53CA;&#x5927;&#x5C0F;&#x3002;

<span class="token comment" spellcheck="true"># Dominator Tree</span>
&#x5217;&#x51FA;&#x6700;&#x5927;&#x7684;&#x5BF9;&#x8C61;&#x4EE5;&#x53CA;&#x5176;&#x4F9D;&#x8D56;&#x5B58;&#x6D3B;&#x7684;Object &#xFF08;&#x5927;&#x5C0F;&#x662F;&#x4EE5;Retained Heap&#x4E3A;&#x6807;&#x51C6;&#x6392;&#x5E8F;&#x7684;&#xFF09;&#x3002;

<span class="token comment" spellcheck="true"># Top Consumers</span>
&#x901A;&#x8FC7;&#x56FE;&#x5F62;&#x5217;&#x51FA;&#x6700;&#x5927;&#x7684;object&#x3002;

<span class="token comment" spellcheck="true"># Shallow heap</span>
Shallow size&#x5C31;&#x662F;&#x5BF9;&#x8C61;&#x672C;&#x8EAB;&#x5360;&#x7528;&#x5185;&#x5B58;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x4E0D;&#x5305;&#x542B;&#x5176;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x3002;&#x9488;&#x5BF9;&#x975E;&#x6570;&#x7EC4;&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x7684;&#x5927;&#x5C0F;&#x5C31;&#x662F;&#x5BF9;&#x8C61;&#x4E0E;&#x5B83;&#x6240;&#x6709;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x5927;&#x5C0F;&#x7684;&#x603B;&#x548C;&#x3002;&#x5F53;&#x7136;&#x8FD9;&#x91CC;&#x9762;&#x8FD8;&#x4F1A;&#x5305;&#x62EC;&#x4E00;&#x4E9B;java&#x8BED;&#x8A00;&#x7279;&#x6027;&#x7684;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x5355;&#x5143;&#x3002;&#x9488;&#x5BF9;&#x6570;&#x7EC4;&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x7684;&#x5927;&#x5C0F;&#x662F;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x5BF9;&#x8C61;&#x7684;&#x5927;&#x5C0F;&#x603B;&#x548C;&#x3002;

<span class="token comment" spellcheck="true">#Retained Heap</span>
&#x5B83;&#x8868;&#x793A;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x88AB;&#x91CA;&#x653E;&#x6389;&#xFF0C;&#x90A3;&#x4F1A;&#x56E0;&#x4E3A;&#x8BE5;&#x5BF9;&#x8C61;&#x7684;&#x91CA;&#x653E;&#x800C;&#x51CF;&#x5C11;&#x5F15;&#x7528;&#x8FDB;&#x800C;&#x88AB;&#x91CA;&#x653E;&#x7684;&#x6240;&#x6709;&#x7684;&#x5BF9;&#x8C61;&#xFF08;&#x5305;&#x62EC;&#x88AB;&#x9012;&#x5F52;&#x91CA;&#x653E;&#x7684;&#xFF09;&#x6240;&#x5360;&#x7528;&#x7684;heap&#x5927;&#x5C0F;&#x3002;<span class="token punctuation">(</span>&#x95F4;&#x63A5;&#x5F15;&#x7528;&#x7684;&#x542B;&#x4E49;&#xFF1A;A-<span class="token operator">&gt;</span>B-<span class="token operator">&gt;</span>C, C&#x5C31;&#x662F;&#x95F4;&#x63A5;&#x5F15;&#x7528;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x91CA;&#x653E;&#x7684;&#x65F6;&#x5019;&#x8FD8;&#x8981;&#x6392;&#x9664;&#x88AB;GC Roots&#x76F4;&#x63A5;&#x6216;&#x95F4;&#x63A5;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x3002;&#x4ED6;&#x4EEC;&#x6682;&#x65F6;&#x4E0D;&#x4F1A;&#x88AB;&#x88AB;&#x5F53;&#x505A;Garbage&#xFF09;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p></p></div><div class="share"><span>分享到</span>&nbsp;<span class="soc"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></span><span class="soc"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></span><span class="soc"><a href="http://twitter.com/home?status=https://brokge.github.io/2019/06/30/Android-应用内存分析/%20吾與爾%20Android 应用内存分析" class="fa fa-twitter"></a></span></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/2019/07/10/Android-Bundle/" title="Android Bundle 详解 "><i class="fa fa-angle-double-left"></i>&nbsp;上一篇: Android Bundle 详解 </a></span><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/2019/05/20/Android-多线程开发实践/" title="Android 多线程开发实践">下一篇: Android 多线程开发实践&nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div><div id="vcomments"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script type="text/javascript">(function(){
    new Valine({
    el: '#vcomments',
    appId: 'UmwJ3stwyISCG9WnW9Nc3SAN-gzGzoHsz',
    appKey: 'UKq878kYn6RXJWx34b77lma6'})
})();
</script></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2019&nbsp;<a target="_blank" href="https://brokge.github.io" rel="noopener noreferrer">brokge</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer><script type="text/javascript" id="maid-script" src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js?v=undefined"></script><script>if (window.mermaid) {
  var options = JSON.parse(document.getElementById('maid-script').getAttribute('mermaidoptioins'));
  mermaid.initialize(options);
}
 </script></div></div></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.js"></script></body></html>