<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Android 性能优化总结 | 吾与尔</title>

  
  <meta name="author" content="brokge">
  

  
  <meta name="description" content="用户手中好的应用指标：
满足需求
合理的交互
高性能

Android 性能优化总结目标:
流畅
稳定
省电、省流量
安装包小

简称： 快、稳、省、小
建议：1. 流畅卡顿场景：UI 绘制、应用启动、页面跳转、事件响应
卡顿原因：

界面绘制。
主要原因是绘制的层级深、页面复杂、刷新不合理，由于这">
  

  
  <meta name="keywords" content="吾与尔">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="Android 性能优化总结">

  <meta property="og:site_name" content="吾与尔">

  
  <meta property="og:image" content="/favicon.ico">
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="吾与尔" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<link rel="stylesheet" href="/css/prism-ghcolors.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">吾与尔</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>Android 性能优化总结</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/07/16/Android-性能优化总结/" rel="bookmark">
        <time class="entry-date published" datetime="2019-07-16T13:09:53.000Z">
          2019-07-16
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="用户手中好的应用指标："><a href="#用户手中好的应用指标：" class="headerlink" title="用户手中好的应用指标："></a>用户手中好的应用指标：</h2><ol>
<li>满足需求</li>
<li>合理的交互</li>
<li>高性能</li>
</ol>
<h2 id="Android-性能优化总结"><a href="#Android-性能优化总结" class="headerlink" title="Android 性能优化总结"></a>Android 性能优化总结</h2><h4 id="目标"><a href="#目标" class="headerlink" title="目标:"></a>目标:</h4><ol>
<li>流畅</li>
<li>稳定</li>
<li>省电、省流量</li>
<li>安装包小</li>
</ol>
<p>简称： 快、稳、省、小</p>
<h4 id="建议："><a href="#建议：" class="headerlink" title="建议："></a>建议：</h4><h5 id="1-流畅"><a href="#1-流畅" class="headerlink" title="1. 流畅"></a>1. 流畅</h5><p>卡顿场景：<br>UI 绘制、应用启动、页面跳转、事件响应</p>
<p>卡顿原因：</p>
<ol>
<li>界面绘制。<blockquote>
<p>主要原因是绘制的层级深、页面复杂、刷新不合理，由于这些原因导致卡顿的场景更多出现在 UI 和启动后的初始界面以及跳转到页面的绘制上。</p>
</blockquote>
</li>
<li>数据处理。<blockquote>
<p>导致这种卡顿场景的原因是数据处理量太大，一般分为三种情况，一是数据在处理 UI 线程，二是数据处理占用 CPU 高，导致主线程拿不到时间片，三是内存增加导致 GC 频繁，从而引起卡顿。</p>
</blockquote>
</li>
</ol>
<p>UI 绘制:</p>
<p>原理： Android 应用程序把经过Measure、Layout、Draw后的 surface 缓存数据，通过 SurfaceFlinger 服务把数据渲染到显示屏幕上， 通过 Android 的刷新机制来刷新数据。也就是说应用层负责绘制，系统层负责渲染，通过进程间通信把应用层需要绘制的数据传递到系统层服务，系统层服务通过刷新机制把数据更新到屏幕上。</p>
<p>卡顿根本原因：</p>
<ol>
<li>绘制任务太重，绘制一帧内容耗时太长。</li>
<li>主线程太忙，根据系统传递过来的 VSYNC 信号来时还没准备好数据导致丢帧。</li>
</ol>
<p>常用工具：<br>通过性能分析工具 Profile GPU Rendering、TraceView、Systrace UI 性能分析<br>找出出现问题的点，然后解决。</p>
<p>优化建议：</p>
<ol>
<li>布局优化</li>
<li>避免过度绘制</li>
<li>启动优化</li>
<li>合理的刷新机制</li>
<li>在实现动画效果时，需要根据不同场景选择合适的动画框架来实现。有些情况下，可以用硬件加速方式来提供流畅度。</li>
</ol>
<h5 id="2-稳定"><a href="#2-稳定" class="headerlink" title="2. 稳定"></a>2. 稳定</h5><blockquote>
<p>Android 应用的稳定性定义很宽泛，影响稳定性的原因很多，比如内存使用不合理、代码异常场景考虑不周全、代码逻辑不合理等，都会对应用的稳定性造成影响。其中最常见的两个场景是：Crash 和 ANR，这两个错误将会使得程序无法使用，比较常用的解决方式如下：</p>
</blockquote>
<h5 id="2-1-内存优化"><a href="#2-1-内存优化" class="headerlink" title="2.1.内存优化"></a>2.1.内存优化</h5><p>虚拟机有两种运行模式：Dalvik 和 ART。</p>
<p>Android 内存控制权 Generational Heap Memory 。</p>
<ul>
<li>对象的生命周期：</li>
</ul>
<p>创建阶段-&gt;应用阶段-&gt;不可见阶段-&gt;不可达阶段-&gt;收集阶段-&gt;终结阶段-&gt;对象空间重新分配阶段</p>
<p>Zygote 进程是所有的应用程序进程之父。</p>
<p>每个应用 都有 Dalvik Heap Size 最大阈值。有 RAM 大小不同会有所差异。</p>
<ul>
<li>内存回收<br>young Generation(年轻代)、Old Generation(年老代)、Permanent Generation(持久代)</li>
</ul>
<p>根据对象的生命周期、所处的代区域、不同的内存数据类型，执行不同的GC 操作。</p>
<blockquote>
<p>分配的对象会存放在 Young Generation 区域。对象在某个时机触发 GC 回收垃圾，而没有回收的就根据不同规则，有可能被移动到 Old Generation，最后累积一定时间在移动到 Permanent Generation 区域。系统会根据内存中不同的内存数据类型分别执行不同的 GC 操作。GC 通过确定对象是否被活动对象引用来确定是否收集对象，进而动态回收无任何引用的对象占据的内存空间。但需要注意的是频繁的 GC 会增加应用的卡顿情况，影响应用的流畅性，因此需要尽量减少系统 GC 行为，以便提高应用的流畅度，减小卡顿发生的概率。</p>
</blockquote>
<p>分析工具：</p>
<ol>
<li>Memory Monitor</li>
<li>Heap Viewer</li>
<li>Allocation Tracker</li>
<li>Memory Analyzer Tool(MAT)</li>
<li>LeakCanary 第三方库.</li>
</ol>
<p>常见内存泄漏场景:</p>
<ol>
<li>资源性对象未关闭。比如Cursor、File文件等，往往都用了一些缓冲，在不使用时，应该及时关闭它们。</li>
<li>注册对象未注销。比如事件注册后未注销，会导致观察者列表中维持着对象的引用。</li>
<li>类的静态变量持有大数据对象。</li>
<li>非静态内部类的静态实例.</li>
<li>Handler临时性内存泄漏。如果Handler是非静态的，容易导致 Activity 或 Service 不会被回收。</li>
<li>容器中的对象没清理造成的内存泄漏。</li>
<li>WebView。WebView 存在着内存泄漏的问题，在应用中只要使用一次 WebView，内存就不会被释放掉。</li>
</ol>
<p>优化内存空间：</p>
<ol>
<li>对象引用。强引用、软引用、弱引用、虚引用四种引用类型，根据业务需求合理使用不同，选择不同的引用类型。</li>
<li>减少不必要的内存开销。注意自动装箱，增加内存复用，比如有效利用系统自带的资源、视图复用、对象池、Bitmap对象的复用。</li>
<li>使用最优的数据类型。比如针对数据类容器结构，可以使用ArrayMap数据结构，避免使用枚举类型，使用缓存Lrucache等等。</li>
<li>图片内存优化。可以设置位图规格，根据采样因子做压缩，用一些图片缓存方式对图片进行管理等等。</li>
</ol>
<h5 id="2-2-提高代码质量"><a href="#2-2-提高代码质量" class="headerlink" title="2.2. 提高代码质量"></a>2.2. 提高代码质量</h5><blockquote>
<p>提高代码质量。比如开发期间的代码审核，看些代码设计逻辑，业务合理性等。<br>代码静态扫描工具。常见工具有Android Lint、Findbugs、Checkstyle、PMD等等。<br>Crash监控。把一些崩溃的信息，异常信息及时地记录下来，以便后续分析解决。<br>Crash上传机制。在Crash后，尽量先保存日志到本地，然后等下一次网络正常时再上传日志信息。</p>
</blockquote>
<h5 id="3-电量优化"><a href="#3-电量优化" class="headerlink" title="3. 电量优化"></a>3. 电量优化</h5><ol>
<li>优化耗时的计算。</li>
</ol>
<h5 id="4-安装包大小"><a href="#4-安装包大小" class="headerlink" title="4. 安装包大小"></a>4. 安装包大小</h5><ol>
<li>代码混淆。</li>
<li>资源优化。比如使用 Android Lint 删除冗余资源。</li>
<li>图片优化。比如利用 AAPT 工具对 PNG 格式的图片做压缩处理，降低图片色彩位数、使用 WebP图片格式等。</li>
<li>避免重复功能的库。</li>
<li>插件化。</li>
</ol>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Android/">Android</a>, <a href="/categories/Android/性能优化/">性能优化</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Android/">Android</a><a href="/tags/性能优化/">性能优化</a>
    </span>
    

    </div>

    
  </div>
</article>


    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    <br>
    
    &copy; 2019 brokge
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>